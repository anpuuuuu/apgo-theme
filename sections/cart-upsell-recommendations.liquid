{% comment %}
  è³¼ç‰©è»Šé -åŠ è³¼æ¨è–¦å€å¡Š
  æª”æ¡ˆä½ç½®: sections/cart-upsell-recommendations.liquid
{% endcomment %}

<!-- å…§è¯é—œéµæ¨£å¼é˜²æ­¢é–ƒçˆ -->
<style>
  /* ç§»é™¤æ‰€æœ‰å¯èƒ½çš„å®¹å™¨èƒŒæ™¯è‰² */
  .shopify-section,
  .shopify-section[class*="cart-upsell"],
  [class*="shopify-section-template"][class*="cart_upsell"],
  .section-cart-upsell {
    background-color: transparent !important;
    background: transparent !important;
    background-image: none !important;
  }
  
  /* ç¢ºä¿ wrapper å®Œå…¨é€æ˜ */
  .cart-upsell-wrapper {
    background-color: transparent !important;
    background: transparent !important;
    background-image: none !important;
  }
  
  /* ç¢ºä¿åªæœ‰å…§éƒ¨å®¹å™¨æœ‰èƒŒæ™¯è‰² */
  .cart-upsell-section {
    background-color: {{ section.settings.loading_bg_color }} !important;
    min-height: 120px;
  }
  
  /* é˜²æ­¢ç€è¦½å™¨é è¨­çš„ç¶ è‰²ç„¦é»æ¨£å¼ */
  .cart-upsell-wrapper button:focus,
  .cart-upsell-wrapper a:focus {
    outline: none !important;
    outline-color: transparent !important;
    outline-style: none !important;
  }
</style>

<style>
  /* ========================================
     è³¼ç‰©è»ŠåŠ è³¼å€å¡Š - AKO é¢¨æ ¼è¨­è¨ˆ
     ======================================== */
  
  /* å¤–å±¤åŒ…è£å™¨ */
  .cart-upsell-wrapper {
    width: 100%;
    max-width: 1240px;
    margin: 20px auto 0;
    padding: 0 20px;
    position: relative;
    background: transparent !important;
    background-color: transparent !important;
  }
  
  /* é ‚éƒ¨æ¨™é¡Œå€åŸŸ */
  .upsell-header-outside {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 0 4px;
  }
  
  /* æ¨™é¡Œæ¨£å¼ - ä¿æŒåŸæœ‰è¨­è¨ˆ */
  .upsell-title-outside {
    font-size: 18px;
    font-weight: 600;
    color: {{ section.settings.text_color }} !important;
    margin: 0;
    position: relative;
    padding-left: 12px;
  }
  
  .upsell-title-outside::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 20px;
    background: {% if section.settings.use_accent_gradient %}
      linear-gradient(135deg, {{ section.settings.accent_color_start }}, {{ section.settings.accent_color_end }})
    {% else %}
      {{ section.settings.accent_color_start }}
    {% endif %} !important;
    border-radius: 2px;
  }
  
  /* ä¸»å®¹å™¨ - ä»¿ AKO å®¹å™¨é¢¨æ ¼ */
  .cart-upsell-section {
    background: transparent !important;
    border-radius: 0;
    box-shadow: none;
    border: none;
    padding: 20px;
    overflow: hidden;
    box-sizing: border-box;
    position: relative;
    will-change: transform;
  }

  /* é ‚éƒ¨æ©˜è‰²ç·šæ¢ - å·²ç§»é™¤ */
  .cart-upsell-section::before {
    display: none;
  }
  
  /* æŸ¥çœ‹ç†±é–€åŠ è³¼æŒ‰éˆ• - æ”¾åœ¨å®¹å™¨å¤–å³ä¸‹è§’ */
  .view-popular-btn-wrapper {
    position: absolute;
    bottom: -40px;
    right: 20px;
    z-index: 10;
  }
  
  .view-popular-btn {
    background: transparent !important;
    color: {{ section.settings.accent_color_start }} !important;
    border: 1px solid {{ section.settings.accent_color_start }} !important;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
  }

  .view-popular-btn:hover {
    background: {% if section.settings.use_accent_gradient %}
      linear-gradient(135deg, {{ section.settings.accent_color_start }}, {{ section.settings.accent_color_end }})
    {% else %}
      {{ section.settings.accent_color_start }}
    {% endif %} !important;
    color: #ffffff !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
  }

  /* å•†å“æ»‘å‹•å®¹å™¨ */
  .upsell-slider-container {
    position: relative;
    overflow: hidden;
    margin: 0 -20px;
    padding: 0 20px;
  }

  .upsell-slider {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 12px 0;
    scrollbar-width: thin;
    scrollbar-color: #ff6b35 #333333;
    -webkit-overflow-scrolling: touch;
  }

  .upsell-slider::-webkit-scrollbar {
    height: 6px;
  }

  .upsell-slider::-webkit-scrollbar-track {
    background: #333333 !important;
    border-radius: 3px;
  }

  .upsell-slider::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #ff6b35, #f7931e) !important;
    border-radius: 3px;
  }

  /* å•†å“å¡ç‰‡ - æ©«å¼ä½ˆå±€ */
  .upsell-product-card {
    flex: 0 0 var(--card-width-desktop, 320px);
    background: linear-gradient(145deg, #2d2d2d, #1a1a1a) !important;
    border: 1px solid #404040 !important;
    border-radius: 10px;
    padding: 16px 10px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .upsell-product-card:hover {
    border-color: #ff6b35 !important;
    transform: translateY(-4px);
    box-shadow: 
      0 12px 35px rgba(255, 107, 53, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* å•†å“åœ–ç‰‡ */
  .upsell-product-image {
    width: 60px;
    height: 70px;
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .upsell-product-image.portrait {
    width: 60px;
    height: 75px;
  }

  .upsell-product-image.landscape {
    width: 70px;
    height: 60px;
  }

  .upsell-product-image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Placeholder SVG æ¨£å¼ */
  .upsell-product-image .placeholder-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.3;
    filter: invert(1);
  }

  /* ç”¢å“é€£çµæ¨£å¼ */
  .upsell-product-link {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    text-decoration: none;
    color: inherit;
  }

  .upsell-product-card:hover .upsell-product-title {
    color: #ff6b35 !important;
  }

  /* è¼‰å…¥ç‹€æ…‹æ¨£å¼ */
  .cart-upsell-section.loading {
    min-height: 150px;
    position: relative;
  }

  .cart-upsell-section.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid #333333 !important;
    border-top-color: #ff6b35 !important;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }

  /* å•†å“è³‡è¨Š */
  .upsell-product-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .upsell-product-title {
    font-size: 13px;
    font-weight: 500;
    color: {{ section.settings.text_color }} !important;
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    line-height: 1.3;
  }

  .upsell-product-price {
    font-size: 14px;
    font-weight: 700;
    color: {{ section.settings.accent_color_start }} !important;
    margin: 0;
    text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
  }

  /* åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ• */
  .upsell-add-to-cart {
    width: 36px;
    height: 36px;
    background: transparent !important;
    border: 2px solid {{ section.settings.accent_color_start }} !important;
    border-radius: 6px;
    color: {{ section.settings.accent_color_start }} !important;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    outline: none !important;
    -webkit-tap-highlight-color: transparent;
  }

  .upsell-add-to-cart:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  .upsell-add-to-cart:focus-visible {
    outline: none !important;
    box-shadow: 0 0 0 2px {{ section.settings.accent_color_start }}40 !important;
  }

  .upsell-add-to-cart:active {
    transform: scale(0.95);
  }

  .upsell-add-to-cart * {
    pointer-events: none;
  }

  .upsell-add-to-cart::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: {% if section.settings.use_accent_gradient %}
      linear-gradient(135deg, {{ section.settings.accent_color_start }}, {{ section.settings.accent_color_end }})
    {% else %}
      {{ section.settings.accent_color_start }}
    {% endif %} !important;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
  }

  .upsell-add-to-cart:hover::before {
    left: 0;
  }

  .upsell-add-to-cart span {
    position: relative;
    z-index: 1;
    transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .upsell-add-to-cart:hover {
    border-color: #ff6b35 !important;
    color: #ffffff !important;
  }

  .upsell-add-to-cart:hover span {
    color: #ffffff !important;
  }

  .upsell-add-to-cart.loading {
    pointer-events: none;
    opacity: 0.7;
  }

  .upsell-add-to-cart.added {
    border-color: {{ section.settings.accent_color_start }} !important;
    color: {{ section.settings.accent_color_start }} !important;
  }

  .upsell-add-to-cart.added span {
    color: {{ section.settings.accent_color_start }} !important;
  }

  /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
  @media (max-width: 768px) {
    .cart-upsell-wrapper {
      padding: 0 16px;
    }
    
    .upsell-header-outside {
      margin-bottom: 12px;
    }

    .cart-upsell-section {
      padding: 16px;
      border-radius: 16px;
    }

    .upsell-title-outside {
      font-size: 16px;
    }
    
    .view-popular-btn-wrapper {
      bottom: -50px;
      right: 16px;
    }

    .view-popular-btn {
      padding: 8px 20px;
      font-size: 14px;
    }

    .upsell-slider-container {
      margin: 0 -16px;
      padding: 0 16px;
    }

    .upsell-product-card {
      flex: 0 0 280px;
    }

    .upsell-product-image {
      width: 70px;
      height: 70px;
    }
  }

  @media (max-width: 480px) {
    .view-popular-btn-wrapper {
      position: static;
      margin-top: 16px;
      text-align: right;
      padding-right: 4px;
    }
    
    .upsell-product-card {
      flex: 0 0 240px;
    }

    .upsell-product-title {
      font-size: 13px;
    }

    .upsell-product-price {
      font-size: 14px;
    }

    .upsell-add-to-cart {
      height: 36px;
      font-size: 14px;
    }
  }

  /* æ‰‹æ©Ÿç‰ˆç›´å¼ä½ˆå±€é¸é … */
  @media (max-width: 480px) {
    .cart-upsell-wrapper[data-mobile-layout="vertical"] .upsell-product-card {
      flex-direction: column;
      width: 140px;
      flex: 0 0 140px;
      padding: 12px;
    }

    .cart-upsell-wrapper[data-mobile-layout="vertical"] .upsell-product-link {
      flex-direction: column;
      text-align: center;
    }

    .cart-upsell-wrapper[data-mobile-layout="vertical"] .upsell-product-image {
      width: 100%;
      height: 116px;
      margin-bottom: 8px;
    }

    .cart-upsell-wrapper[data-mobile-layout="vertical"] .upsell-product-info {
      text-align: center;
      margin-bottom: 8px;
    }

    .cart-upsell-wrapper[data-mobile-layout="vertical"] .upsell-add-to-cart {
      width: 100%;
    }
  }

  /* æ‰‹æ©Ÿç‰ˆéš±è—åƒ¹æ ¼é¸é … */
  @media (max-width: 480px) {
    .cart-upsell-wrapper[data-hide-price-mobile="true"] .upsell-product-price {
      display: none;
    }
  }

  /* æ‰‹æ©Ÿç‰ˆå¯è¦‹å•†å“æ•¸æ§åˆ¶ */
  @media (max-width: 480px) {
    .upsell-slider {
      gap: 12px;
    }
    
    .cart-upsell-wrapper[data-products-visible="1.2"] .upsell-product-card {
      flex: 0 0 calc((100vw - 48px) / 1.2);
    }
    
    .cart-upsell-wrapper[data-products-visible="1.5"] .upsell-product-card {
      flex: 0 0 calc((100vw - 48px) / 1.5);
    }
    
    .cart-upsell-wrapper[data-products-visible="2"] .upsell-product-card {
      flex: 0 0 calc((100vw - 60px) / 2);
    }
  }

  /* æ‰‹æ©Ÿç‰ˆéš±è—æŒ‰éˆ•æ–‡å­—é¸é … */
  @media (max-width: 480px) {
    .cart-upsell-wrapper[data-hide-button-text="true"] .view-popular-btn {
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
      justify-content: center;
    }
    
    .cart-upsell-wrapper[data-hide-button-text="true"] .view-popular-btn span {
      display: none;
    }
  }
</style>

<div class="cart-upsell-wrapper" 
     style="--card-width-desktop: {{ section.settings.card_width_desktop }}px;
            --card-width-tablet: {{ section.settings.card_width_tablet }}px;
            --card-width-mobile-large: {{ section.settings.card_width_mobile_large }}px;
            --card-width-mobile: {{ section.settings.card_width_mobile }}px;
            --button-max-width: {{ section.settings.button_max_width }}px;"
     data-mobile-layout="{{ section.settings.mobile_layout }}"
     data-hide-price-mobile="{{ section.settings.hide_price_mobile }}"
     data-products-visible="{{ section.settings.products_visible_mobile }}"
     data-hide-button-text="{{ section.settings.hide_button_text_mobile }}">
  
  <!-- æ¨™é¡Œåœ¨å®¹å™¨å¤– -->
  <div class="upsell-header-outside">
    <h3 class="upsell-title-outside">{{ section.settings.section_title }}</h3>
  </div>
  
  <!-- ä¸»å®¹å™¨ -->
  <div class="cart-upsell-section">
    <div class="upsell-slider-container">
      <div class="upsell-slider" id="upsell-slider-{{ section.id }}">
        {% if section.settings.product_list != blank %}
          {% for product in section.settings.product_list limit: section.settings.max_products %}
            {% assign img_width = 400 %}
            {% case section.settings.image_ratio %}
              {% when 'square' %}
                {% assign img_height = 400 %}
              {% when 'portrait' %}
                {% assign img_height = 500 %}
              {% when 'landscape' %}
                {% assign img_height = 300 %}
              {% else %}
                {% assign img_height = 400 %}
            {% endcase %}
            
            <div class="upsell-product-card">
              <a href="{{ product.url }}" class="upsell-product-link">
                <div class="upsell-product-image {{ section.settings.image_ratio }}">
                  {% if product.featured_image %}
                    <img src="{{ product.featured_image | image_url: width: img_width }}"
                         alt="{{ product.title | escape }}"
                         width="{{ img_width }}"
                         height="{{ img_height }}"
                         loading="lazy">
                  {% else %}
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  {% endif %}
                </div>
                <div class="upsell-product-info">
                  <h4 class="upsell-product-title">{{ product.title }}</h4>
                  {% if section.settings.show_prices %}
                    <p class="upsell-product-price">{{ product.price | money }}</p>
                  {% endif %}
                </div>
              </a>
              {% if section.settings.enable_quick_add %}
                <button type="button" 
                        class="upsell-add-to-cart"
                        data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                        data-product-id="{{ product.id }}"
                        onclick="event.preventDefault(); event.stopPropagation(); addToCartUpsell(this, event);">
                  <span>+</span>
                </button>
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <!-- é è¨­å•†å“é¡¯ç¤ºï¼ˆç·¨è¼¯å™¨é è¦½ç”¨ï¼‰ -->
          {% assign img_width = 400 %}
          {% case section.settings.image_ratio %}
            {% when 'square' %}
              {% assign img_height = 400 %}
            {% when 'portrait' %}
              {% assign img_height = 500 %}
            {% when 'landscape' %}
              {% assign img_height = 300 %}
            {% else %}
              {% assign img_height = 400 %}
          {% endcase %}
          
          {% for i in (1..4) %}
            <div class="upsell-product-card">
              <div class="upsell-product-image {{ section.settings.image_ratio }}">
                {{ 'product-' | append: i | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
              <div class="upsell-product-info">
                <h4 class="upsell-product-title">ç¯„ä¾‹å•†å“ {{ i }}</h4>
                {% if section.settings.show_prices %}
                  <p class="upsell-product-price">NT$ {{ i | times: 580 }}</p>
                {% endif %}
              </div>
              {% if section.settings.enable_quick_add %}
                <button type="button" class="upsell-add-to-cart" disabled>
                  <span>+</span>
                </button>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
  
  <!-- æŸ¥çœ‹ç†±é–€æŒ‰éˆ•åœ¨å®¹å™¨å¤–å³ä¸‹è§’ -->
  {% if section.settings.show_popular_button %}
    <div class="view-popular-btn-wrapper">
      <a href="{{ section.settings.popular_items_url }}" class="view-popular-btn">
        <span>{{ section.settings.button_text }}</span>
        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
          <path d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"/>
        </svg>
      </a>
    </div>
  {% endif %}
</div>

<script>
  // é˜²æ­¢è¼‰å…¥æ™‚çš„ç™½è‰²é–ƒçˆ
  document.addEventListener('DOMContentLoaded', function() {
    const wrapper = document.querySelector('.cart-upsell-wrapper');
    if (wrapper) {
      wrapper.style.opacity = '0';
      wrapper.style.transition = 'opacity 0.3s ease';
      
      // ç¢ºä¿å…§å®¹è¼‰å…¥å¾Œå†é¡¯ç¤º
      setTimeout(() => {
        wrapper.style.opacity = '1';
      }, 100);
    }
  });

  // åŠ å…¥è³¼ç‰©è»ŠåŠŸèƒ½ - Savor ä¸»é¡Œå°ˆç”¨
  function addToCartUpsell(button, event) {
    event.preventDefault();
    event.stopPropagation();
    
    const variantId = button.dataset.variantId;
    const productId = button.dataset.productId;
    
    if (!variantId) return;
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    button.classList.add('loading');
    button.innerHTML = '<span>...</span>';
    
    // ä½¿ç”¨ Shopify Cart API
    fetch(window.Shopify.routes.root + 'cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify({
        items: [{
          id: parseInt(variantId),
          quantity: 1
        }]
      })
    })
    .then(response => response.json())
    .then(data => {
      // æˆåŠŸåŠ å…¥è³¼ç‰©è»Š
      button.classList.remove('loading');
      button.classList.add('added');
      button.innerHTML = '<span>âœ“</span>';
      
      // Savor/Horizon AI ä¸»é¡Œå°ˆç”¨æ›´æ–°æ–¹æ³•
      console.log('ğŸ”„ é–‹å§‹æ›´æ–°è³¼ç‰©è»Š...');
      
      import('@theme/events').then(({ CartUpdateEvent }) => {
        console.log('âœ… æˆåŠŸè¼‰å…¥ @theme/events');
        const cartDrawer = document.querySelector('cart-drawer-component');
        
        // å–å¾—æœ€æ–°è³¼ç‰©è»Šè³‡æ–™
        fetch('/cart.js')
          .then(res => res.json())
          .then(cart => {
            console.log('ğŸ“¦ è³¼ç‰©è»Šè³‡æ–™:', cart);
            
            // ç™¼é€ CartUpdateEvent
            const event = new CartUpdateEvent(cart, 'manual-trigger', {
              itemCount: cart.item_count,
              source: 'upsell-block',
              sections: {}
            });
            console.log('ğŸ“¤ ç™¼é€ CartUpdateEvent');
            document.dispatchEvent(event);
            
            // é–‹å•Ÿè³¼ç‰©è»ŠæŠ½å±œ
            if (cartDrawer) {
              console.log('ğŸ” æ‰¾åˆ°è³¼ç‰©è»ŠæŠ½å±œ:', cartDrawer);
              if (cartDrawer.hasAttribute('auto-open')) {
                console.log('ğŸšª å˜—è©¦é–‹å•Ÿè³¼ç‰©è»ŠæŠ½å±œ (auto-open)');
                cartDrawer.open();
              } else {
                console.log('ğŸšª å˜—è©¦é–‹å•Ÿè³¼ç‰©è»ŠæŠ½å±œ (æ‰‹å‹•)');
                if (typeof cartDrawer.open === 'function') {
                  cartDrawer.open();
                } else if (typeof cartDrawer.toggle === 'function') {
                  cartDrawer.toggle(true);
                }
              }
            }
          });
      }).catch((error) => {
        console.error('âŒ ç„¡æ³•è¼‰å…¥ @theme/events:', error);
        console.log('ğŸ”„ ä½¿ç”¨å‚™ç”¨æ–¹æ³•æ›´æ–°è³¼ç‰©è»Š...');
        
        // å‚™ç”¨æ–¹æ³•
        const cartDrawer = document.querySelector('cart-drawer-component, cart-drawer, .cart-drawer');
        
        // å˜—è©¦è§¸ç™¼è³¼ç‰©è»Šæ›´æ–°
        fetch('/cart.js')
          .then(res => res.json())
          .then(cart => {
            // æ¨™æº– cart:refresh äº‹ä»¶
            document.documentElement.dispatchEvent(new CustomEvent('cart:refresh', {
              bubbles: true,
              detail: { cart: cart }
            }));
            
            // å˜—è©¦é–‹å•Ÿè³¼ç‰©è»Š
            if (cartDrawer && typeof cartDrawer.open === 'function') {
              cartDrawer.open();
            } else {
              // å˜—è©¦é»æ“Šè³¼ç‰©è»ŠæŒ‰éˆ•
              const cartButton = document.querySelector('[data-cart-drawer-toggle], [data-cart-toggle], .cart-toggle');
              if (cartButton) cartButton.click();
            }
          });
      });
      
      // 3ç§’å¾Œæ¢å¾©åŸç‹€
      setTimeout(() => {
        button.classList.remove('added');
        button.innerHTML = '<span>+</span>';
      }, 3000);
    })
    .catch(error => {
      console.error('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
      button.classList.remove('loading');
      button.innerHTML = '<span>âœ—</span>';
      
      setTimeout(() => {
        button.innerHTML = '<span>+</span>';
      }, 2000);
    });
  }
</script>

{% schema %}
{
  "name": "è³¼ç‰©è»Šé -åŠ è³¼æ¨è–¦å€å¡Š",
  "class": "section-cart-upsell",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "åŸºæœ¬è¨­å®š"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "å€å¡Šæ¨™é¡Œ",
      "default": "æ¨è–¦åŠ è³¼å•†å“"
    },
    {
      "type": "checkbox",
      "id": "show_popular_button",
      "label": "é¡¯ç¤ºæŸ¥çœ‹ç†±é–€æŒ‰éˆ•",
      "default": true
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "æŒ‰éˆ•æ–‡å­—",
      "default": "æŸ¥çœ‹ç†±é–€åŠ è³¼é …ç›®"
    },
    {
      "type": "url",
      "id": "popular_items_url",
      "label": "ç†±é–€å•†å“é é¢é€£çµ"
    },
    {
      "type": "header",
      "content": "é¡è‰²è¨­å®š"
    },
    {
      "type": "color",
      "id": "loading_bg_color",
      "label": "è¼‰å…¥èƒŒæ™¯è‰²",
      "default": "#1a1a1a",
      "info": "é˜²æ­¢è¼‰å…¥æ™‚ç™½è‰²é–ƒçˆçš„é è¨­èƒŒæ™¯è‰²"
    },
    {
      "type": "checkbox",
      "id": "use_gradient",
      "label": "ä½¿ç”¨æ¼¸è®ŠèƒŒæ™¯",
      "default": true
    },
    {
      "type": "color",
      "id": "bg_color_start",
      "label": "èƒŒæ™¯è‰²ï¼ˆèµ·å§‹ï¼‰",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "bg_color_end",
      "label": "èƒŒæ™¯è‰²ï¼ˆçµæŸï¼‰",
      "default": "#2d2d2d",
      "info": "åƒ…åœ¨å•Ÿç”¨æ¼¸è®Šæ™‚ä½¿ç”¨"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "é‚Šæ¡†é¡è‰²",
      "default": "#333333"
    },
    {
      "type": "checkbox",
      "id": "use_accent_gradient",
      "label": "ä½¿ç”¨å¼·èª¿è‰²æ¼¸è®Š",
      "default": true
    },
    {
      "type": "color",
      "id": "accent_color_start",
      "label": "å¼·èª¿è‰²ï¼ˆèµ·å§‹ï¼‰",
      "default": "#ff6b35"
    },
    {
      "type": "color",
      "id": "accent_color_end",
      "label": "å¼·èª¿è‰²ï¼ˆçµæŸï¼‰",
      "default": "#f7931e",
      "info": "ç”¨æ–¼é ‚éƒ¨ç·šæ¢ã€æŒ‰éˆ•ã€åƒ¹æ ¼ç­‰"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "æ–‡å­—é¡è‰²",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_secondary_color",
      "label": "æ¬¡è¦æ–‡å­—é¡è‰²",
      "default": "#cccccc"
    },
    {
      "type": "header",
      "content": "å•†å“è¨­å®š"
    },
    {
      "type": "product_list",
      "id": "product_list",
      "label": "é¸æ“‡æ¨è–¦å•†å“",
      "limit": 12
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "æœ€å¤šé¡¯ç¤ºå•†å“æ•¸",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_prices",
      "label": "é¡¯ç¤ºåƒ¹æ ¼",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "å•Ÿç”¨å¿«é€ŸåŠ å…¥è³¼ç‰©è»Š",
      "default": true
    },
    {
      "type": "header",
      "content": "é¡¯ç¤ºè¨­å®š"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "åœ–ç‰‡æ¯”ä¾‹",
      "options": [
        {
          "value": "square",
          "label": "æ­£æ–¹å½¢ (1:1)"
        },
        {
          "value": "portrait",
          "label": "ç›´å¼ (4:5)"
        },
        {
          "value": "landscape",
          "label": "æ©«å¼ (4:3)"
        }
      ],
      "default": "square"
    },
    {
      "type": "header",
      "content": "éŸ¿æ‡‰å¼è¨­è¨ˆ"
    },
    {
      "type": "range",
      "id": "card_width_desktop",
      "label": "æ¡Œé¢ç‰ˆå¡ç‰‡å¯¬åº¦",
      "min": 280,
      "max": 400,
      "step": 10,
      "unit": "px",
      "default": 320
    },
    {
      "type": "range",
      "id": "card_width_tablet",
      "label": "å¹³æ¿ç‰ˆå¡ç‰‡å¯¬åº¦",
      "min": 240,
      "max": 340,
      "step": 10,
      "unit": "px",
      "default": 280
    },
    {
      "type": "range",
      "id": "card_width_mobile_large",
      "label": "å¤§æ‰‹æ©Ÿç‰ˆå¡ç‰‡å¯¬åº¦",
      "min": 240,
      "max": 320,
      "step": 10,
      "unit": "px",
      "default": 300
    },
    {
      "type": "range",
      "id": "card_width_mobile",
      "label": "æ‰‹æ©Ÿç‰ˆå¡ç‰‡å¯¬åº¦",
      "min": 220,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 260
    },
    {
      "type": "range",
      "id": "button_max_width",
      "label": "ç†±é–€æŒ‰éˆ•æœ€å¤§å¯¬åº¦",
      "min": 80,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 150,
      "info": "é™åˆ¶æŒ‰éˆ•çš„æœ€å¤§å¯¬åº¦ï¼Œæ‰‹æ©Ÿç‰ˆå»ºè­°è¨­å®š 100-120px"
    },
    {
      "type": "checkbox",
      "id": "hide_button_text_mobile",
      "label": "æ‰‹æ©Ÿç‰ˆåªé¡¯ç¤ºåœ–æ¨™",
      "default": false,
      "info": "åœ¨å°è¢å¹•ä¸Šéš±è—æŒ‰éˆ•æ–‡å­—ï¼Œåªä¿ç•™ç®­é ­åœ–æ¨™"
    },
    {
      "type": "header",
      "content": "é€²éšè¨­å®š"
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "label": "æ‰‹æ©Ÿç‰ˆä½ˆå±€",
      "options": [
        {
          "value": "horizontal",
          "label": "æ©«å¼ï¼ˆåœ–ç‰‡åœ¨å·¦ï¼‰"
        },
        {
          "value": "vertical",
          "label": "ç›´å¼ï¼ˆåœ–ç‰‡åœ¨ä¸Šï¼‰"
        }
      ],
      "default": "horizontal",
      "info": "é¸æ“‡åœ¨å°è¢å¹•ä¸Šçš„é¡¯ç¤ºæ–¹å¼"
    },
    {
      "type": "checkbox",
      "id": "hide_price_mobile",
      "label": "æ‰‹æ©Ÿç‰ˆéš±è—åƒ¹æ ¼",
      "default": false,
      "info": "åœ¨å°è¢å¹•ä¸Šéš±è—åƒ¹æ ¼ä»¥ç¯€çœç©ºé–“"
    },
    {
      "type": "range",
      "id": "products_visible_mobile",
      "label": "æ‰‹æ©Ÿç‰ˆå¯è¦‹å•†å“æ•¸",
      "min": 1.2,
      "max": 2.5,
      "step": 0.1,
      "default": 1.5,
      "info": "æ§åˆ¶æ‰‹æ©Ÿç‰ˆä¸€æ¬¡å¯è¦‹çš„å•†å“æ•¸é‡"
    }
  ],
  "presets": [
    {
      "name": "è³¼ç‰©è»ŠåŠ è³¼æ¨è–¦",
      "category": "éŠ·å”®åŠŸèƒ½"
    }
  ]
}
{% endschema %}